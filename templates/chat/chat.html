{% extends "base.html" %}

{% block page_title %}Conversation: {{ chat.name }}{% endblock %}

{% block page_header %}
    <h2>
        {{ chat.name }}
        <span id="created-by">
            &mdash; a conversation started by <span>{{ chat.created_by }}</span>
        </span>
    </h2>
{% endblock %}

{% block body_id %}chat-page{% endblock %}

{% block content %}
    <div id="chat-container">
        {% if filters %}            
            {% if filters.user %}
                <p class="filter">
                    Showing posts made by <span class="criteria">{{ filters.user }}</span>.
                    <a href=".">Clear filter?</a>
                </p>
            {% endif %}
            {% if filters.search %}
                <p class="filter">
                    Keyword search: <span class="criteria">{{ filters.search }}</span>
                    <a href=".">Clear filter?</a>
                </p>
            {% endif %}
        {% endif %}
        
        {% if posts %}
            <table id="chat" cellspacing="0">
                {% for post in posts %}
                    <tr{% ifequal post.user user %} class="me"{% endifequal %}>
                        <th>
                            {{ post.user }}
                            {# <span class="timestamp">@&nbsp;{{ post.timestamp|date:"H:i" }}</span> #}
                        </th>
                        <td>
                            {{ post.content }}
                        </td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>
                {% if filters %}
                    No posts in this conversation matched the filter criteria.
                {% else %}
                    Nobody has contributed to this conversation yet.  Start
                    things off by typing in the text box below.
                {% endif %}
            </p>
        {% endif %}
    </div>

    <div id="users">
        <h3>Users</h3>
        <ul id="active">
            {% if not chat.users %}
                <li>No users yet</li>
            {% endif %}
            {% for chatuser in chat.users %}
                <li{% ifequal chatuser user %} class="me"{% endifequal %}>
                    <a href="./?user={{ chatuser }}">{{ chatuser }}</a>
                </li>
            {% endfor %}
        </ul>
        <p class="note"><strong>Note:</strong> Click on a username to
        show only that users's posts.</p>
        
        <h3>Search this conversation</h3>
        <form id="search" action="." method="get">
            <label for="q">Keywords</label>
            <input id="q" name="q" type="text" value="" />
            <input type="submit" value="Search" />
        </form>
    </div>

    <div id="post">
        <form id="post-form" action="{% url chat_post chat.slug %}" method="post">
            <input id="post-submit" type="submit" value="Post!" />
            <textarea id="post-content" name="content" rows="2"></textarea>
        </form>
    </div>
{% endblock %}